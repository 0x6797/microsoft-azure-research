# IoT Hub Device Provisioning Service に関するよくあるかもしれない質問

## 目次

- [Device Provisioning Service とは何ですか？](#q-about)
- [何を言っているかわかりません…もう少しわかりやすく説明して下さい](#q-about2)
- [プロビジョニングとは何ですか？](#q-about3)
- [プロビジョニングする時にデバイスに必要な情報は何ですか？](#q-id-requirement)
- [プロビジョニングする場合に必要な手順は何ですか？](#q-task-requirement)
- [Device Provisioning Serviceに制限はありますか？](#q-quotas)
- [プロビジョニングされたデバイスを違う IoT Hub に接続し直す事はできますか？](#q-re-provisioning)
- [プロビジョニングされたデバイスが不正に使われている事がわかりました。どうしたらいいですか？](#q-blacklist)
- [デバイスが違う IoT Hub に移動したり、廃棄されます。プロビジョニングを停止する方法はありますか？](#q-remove-device)


## <a id="q-about">Device Provisioning Service とは何ですか？</a>

IoT Hub Device Provisioning Service は、適切な IoT ハブへのゼロタッチでジャストインタイムなプロビジョニングを可能にする、IoT Hub のヘルパー サービスです。

## <a id="q-about2">何を言っているかわかりません…もう少しわかりやすく説明して下さい</a>

- プロビジョニングを行います
- プロビジョニングは人の介入を必要とせず自動で行われます
- 単一あるいは複数の IoT Hub に接続するように設定します
- デバイスの変化にもとづいて再プロビジョニングします

## <a id="q-about3">プロビジョニングとは何ですか？</a>

Device Proivisioning Service の文脈では、プロビジョニングは次のことを指します。

- デバイスに対して、IoT Hub への接続情報を設定する
- デバイスツインを使用して、望ましい状態を取得する

たとえば、デバイスを工場から出荷し、デバイス利用者がはじめてデバイスを利用する時に、プロビジョニングが行われ、IoT Hub への接続情報がデバイスに設定されます。

- [プロビジョニングする時にデバイスに必要な情報はなんですか？](#q-id-requirement)

## <a id="q-id-requirement">プロビジョニングする時にデバイスに必要な情報は何ですか？</a>

デバイス製造元はデバイスのデプロイ担当者や利用者に **識別キー情報** を提供する必要があります。

これに付随する情報としては、次のようなものいずれかをすべてのデバイスで用意する必要があります。

- X.508 証明書
- TPM 保証キーの公開部分
- 対称キー

## <a id="q-task-requirement">プロビジョニングする場合に必要な手順は何ですか？</a>

クラウド側とデバイス側で必要な手順があります。クラウド側ではデバイスの登録とデバイスの望ましい構成の設定、およびデバイスIDと識別キーのマッピングです。デバイス側はデバイスの初期セットアップです。

## <a id="q-quotas">Device Provisioning Serviceに制限はありますか？</a>

クォータ制限があります。次の表は Azure IoT Hub Device Provisioning Service のリソースに適用される制限です。

| リソース | 制限 |
| :----- | :--- |
| サブスクリプションあたりのデバイスプロビジョニングサービスの最大数 | 10 |
| デバイス加入の最大数 | 1,000,000 |
| デバイス登録の最大数 | 1,000,000 |
| デバイス加入グループの最大数 | 100 |
| CA（認証局）の最大数 | 25 |
| リンクされた IoT Hub の最大数 | 50 |
| メッセージの最大サイズ | 96KB |

また一定期間に処理できるサービスの上限については次のとおりです。

| スロットル | ユニットあたりの値 |
| :------- | :------------ |
| 操作 |  200/分/サービス |
| デバイス登録 | 200/分/サービス |
| デバイスのポーリング操作 | 5/10秒/デバイス |


## <a id="q-re-provisioning">プロビジョニングされたデバイスを違う IoT Hub に接続し直す事はできますか？</a>

再プロビジョニングすることによって違う IoT Hub に接続し直す事が可能です。

## <a id="q-blacklist">プロビジョニングされたデバイスが紛失あるいは不正に使われている事がわかりました。どうしたらいいですか？</a>

デバイスを個別にブラックリストに追加することによって、プロビジョニングサービスからデバイスの登録を抹消することができます。

## <a id="q-remove-device">デバイスが違う IoT Hub に移動したり、廃棄されます。プロビジョニングを停止する方法はありますか？</a>

２つのいずれかの方法があります。

- プロビジョニングサービスからデバイスの登録を抹消あるいは無効化する
- IoT Hub からデバイスの登録を解除する

TPM 構成証明や X.509 のリーフ証明書による構成証明を使用するデバイスは、個別登録エントリを編集してプロビジョニングを停止できます。

X.509 構成証明を使用している場合は、登録グループを使用して一括でプロビジョニングの停止が行えます。