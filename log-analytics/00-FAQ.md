# Azure Log Analytics に関するよくありそうな質問

> 現在は Azure Monitor Logs という呼称になっているので、以下はそう読み替えて下さい。

## 目次

- [Azure Log Analytics とは何ですか？](#q-about)
- [何を対象にクエリするのですか？](#q-object)
- [どうやって対象のログをクエリするのですか？](#q-howtoquery)
- [クエリで取得できるデータの範囲に制限はありますか？](#q-query-limit)
- [Log Analytics 以外の方法でログにアクセスできますか？](#q-other-options)
- [エージェント経由で Log Analytics に送信できるデータ量はどのくらいですか？](#q-send-limit)
- [Log Analytics の価格を教えて下さい。](#q-price)


## <a id="q-about">Azure Log Analytics とは何ですか？</a>

Azure Monitor のログをクエリによって抽出して分析し、有用な洞察を得るためのサービスです。

まず [Azure Monitor に関するよくありそうな質問](../monitor/00-FAQ.md)に目を通して下さい。

## <a id="q-object">何を対象にクエリするのですか？</a>

- アラート
- Azure のアクティビティ
- Azure のメトリクス
- Azure の診断結果
- アプリケーションのイベント
- 各 VM、コンテナのイベント
- Syslog
- メッセージ
- イベントログ
- など、多岐に渡ります。

## <a id="q-howtoquery">どうやって対象のログをクエリするのですか？</a>

独自クエリ言語の KQL を使用します。

たとえば、`Event` を対象に50件のデータを取得する場合は、以下のように KQL を記述します。

```kusuto
Event
| limit 50
```

## <a id="q-query-limit">クエリで取得できるデータの範囲に制限はありますか？</a>

既定では以下の制限があります。

- 時間の範囲 : クエリは過去 24 時間に制限されます。
- 結果の数 : 最大 10,000 レコードに制限されます。

時間については、明示的に期間を与えることにより過去 24 時間以前のログも取得可能です。

## <a id="q-other-optoins">Log Analytics 以外の方法でログにアクセスできますか？</a>

| ツール                 | 説明                                                                                                                                                                                |
|:-----------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 警告ルール             | 事前に条件を設定し、ログを定期的に検索することで、ワークスペースのデータの問題を事前に特定します。                                                                                  |
| ダッシュボード         | クエリの結果は Azure ダッシュボードにピンどめできます。                                                                                                                             |
| ビュー                 | ビューデザイナーを使用して、データを視覚化しダッシュボードに含めることができます。                                                                                                  |
| エクスポート           | Azure Monitor から Excel または Power BI にログデータをエクスポートできます。                                                                                                       |
| PowerShell             | `Get-AzOperationalInsightsSearchResults` を使用する Azure Automation Runbook またはコマンドラインから PowerShell スクリプトを実行して、Azure Monitor からログデータを取得できます。 |
| Azure Monitor Logs API | Azure Monitor Logs API を使用すると、任意の REST API クライアントによってワークスペースからログデータを取得することができます。                                                     |

## <a id="q-send-limit">エージェント経由で Log Analytics に送信できるデータ量はどのくらいですか？</a>

アップロードされるデータの量に制限はなく、お客様が選択した価格オプション (容量予約または従量課金制) に基づきます。 Log Analytics ワークスペースは、お客様から送信される量が 1 日あたり数 TB であったとしても、それを処理するように自動的にスケールアップするように設計されています。 詳細については、価格の詳細をご覧ください。

## <a id="q-price">Log Analytics の価格を教えて下さい。</a>

あらかじめログの容量を予約するプランと従量課金プランがあり、さらに保持するデータにより課金されます。

次の表は容量予約プランの価格です。

| 容量        |                                                            料金 | 従量課金性を上回る割引 |
|:------------|----------------------------------------------------------------:|:----------------------:|
| 100 GB/日   |                                                31,830.40 JPY/日 |          15%           |
| 200 GB/日   |                                                59,763.20 JPY/日 |          20%           |
| 300 GB/日   |                                                   87,696 JPY/日 |          22%           |
| 400 GB/日   |                                               114,329.60 JPY/日 |          23%           |
| 500 GB/日   |                                                  140,476 JPY/日 |          25%           |
| 500 GB/日〜 | 140,476 JPY/日<br /> + 28,095.20 JPY/日 <br />(100 GB の増分毎) |          25%           |

次の表は従量課金プランの価格です。Log Analytics ワークスペースに取り込まれたデータ(GB)ごとに課金されます。

| 機能               | 含まれている無料ユニット |          料金 |
|:-------------------|-------------------------:|--------------:|
| データインジェスト |        顧客あたり 5GB/月 | 374.08 JPY/月 |

次の表はデータ保持に関わる価格です。

| 機能       | 含まれている無料ユニット |                    料金 |
|:-----------|:------------------------:|------------------------:|
| データ保持 |           31日           | 1GB あたり 16.80 JPY/月 |